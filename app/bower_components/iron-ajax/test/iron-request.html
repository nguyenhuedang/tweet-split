<!DOCTYPE html><html><head><title>iron-request</title>
    <script>if (!window.customElements) { document.write('<!--'); }</script>
    <script type="text/javascript" src="../../webcomponentsjs/custom-elements-es5-adapter.js"></script>
    <!--! do not remove -->
<script src="../../webcomponentsjs/webcomponents-lite.js"></script><script src="../../web-component-tester/browser.js"></script><link rel="import" href="../../polymer/polymer.html"><link rel="import" href="../../promise-polyfill/promise-polyfill.html"><link rel="import" href="../iron-request.html"></head><body><test-fixture id="TrivialRequest"><template><iron-request></iron-request></template></test-fixture><script>suite('<iron-request>',function(){var a,b,c,d;setup(function(){a={"Content-Type":'application/json'},d=sinon.fakeServer.create(),d.respondWith('GET','/responds_to_get_with_json',[200,a,'{"success":true}']),d.respondWith('GET','/responds_to_get_with_prefixed_json',[200,a,'])}while(1);</x>{"success":true}']),d.respondWith('GET','/responds_to_get_with_500',[500,{},'']),d.respondWith('GET','/responds_to_get_with_100',[100,{},'']),d.respondWith('GET','/responds_to_get_with_0',[0,a,'{"success":true}']),c=fixture('TrivialRequest'),b={url:'/responds_to_get_with_json'},synchronousSuccessfulRequestOptions={url:'/responds_to_get_with_json',async:!1,timeout:100},asynchronousSuccessfulRequestOptions={url:'/responds_to_get_with_json',async:!0,timeout:100}}),teardown(function(){d.restore()}),suite('basic usage',function(){test('creates network requests, requiring only `url`',function(){c.send(b),d.respond(),expect(c.response).to.be.ok}),test('timeout not set if synchronous',function(){c.send(synchronousSuccessfulRequestOptions),expect(c.xhr.async).to.be.eql(!1),expect(c.xhr.timeout).to.be.eql(void 0)}),test('timeout set if asynchronous',function(){c.send(asynchronousSuccessfulRequestOptions),expect(c.xhr.async).to.be.eql(!0),expect(c.xhr.timeout).to.be.eql(100)}),test('sets async to true by default',function(){c.send(b),expect(c.xhr.async).to.be.eql(!0)}),test('can be aborted',function(){return c.send(b),c.abort(),d.respond(),c.completes.then(function(){throw new Error('Request did not abort appropriately!')}).catch(function(){expect(c.response).to.not.be.ok})}),test('can be aborted with request element',function(){var f={url:b.url,rejectWithRequest:!0};return c.send(f),c.abort(),d.respond(),c.completes.then(function(){throw new Error('Request did not abort appropriately!')}).catch(function(g){expect(g.error).to.be.instanceof(Error),expect(g.request).to.deep.equal(c)})}),test('default responseType is text',function(){return c.send(b),d.respond(),c.completes.then(function(){expect(c.response).to.be.an('string')})}),test('default responseType of text is not applied, when async is false',function(){var f=Object.create(b);return f.async=!1,c.send(f),d.respond(),c.completes.then(function(){expect(c.xhr.responseType).to.be.empty})}),test('responseType can be configured via handleAs option',function(){var f=Object.create(b);return f.handleAs='json',c.send(f),expect(d.requests.length).to.be.equal(1),expect(d.requests[0].requestHeaders.accept).to.be.equal('application/json'),d.respond(),c.completes.then(function(){expect(c.response).to.be.an('object')})}),test('setting jsonPrefix correctly strips it from the response',function(){return c.send({url:'/responds_to_get_with_prefixed_json',handleAs:'json',jsonPrefix:'])}while(1);</x>'}),expect(d.requests.length).to.be.equal(1),expect(d.requests[0].requestHeaders.accept).to.be.equal('application/json'),d.respond(),c.completes.then(function(){expect(c.response).to.deep.eq({success:!0})})}),test('responseType cannot be configured via handleAs option, when async is false',function(){var f=Object.create(b);return f.handleAs='json',f.async=!1,c.send(f),expect(d.requests.length).to.be.equal(1),expect(d.requests[0].requestHeaders.accept).to.be.equal('application/json'),d.respond(),c.completes.then(function(){expect(c.response).to.be.a('string')})}),test('headers are sent up',function(){var f=Object.create(b);f.headers={foo:'bar',accept:'this should override the default'},c.send(f),expect(d.requests.length).to.be.equal(1);var g=d.requests[0];expect(g.requestHeaders.foo).to.be.equal('bar'),expect(g.requestHeaders.accept).to.be.equal('this should override the default')}),test('headers are deduped by lowercasing',function(){var f=Object.create(b);f.headers={foo:'bar',Foo:'bar',fOo:'bar',Accept:'this should also override the default'},c.send(f),expect(d.requests.length).to.be.equal(1);var g=d.requests[0];expect(Object.keys(g.requestHeaders).length).to.be.equal(2),expect(g.requestHeaders.foo).to.be.equal('bar'),expect(g.requestHeaders.accept).to.be.equal('this should also override the default')})}),suite('special cases',function(){test('treats status code 0 as success, though the outcome is ambiguous',function(){c.send({url:'/responds_to_get_with_0'}),d.respond(),expect(c.succeeded).to.be.equal(!0)}),test('special form characters',function(){for(var g,f=[{test:null,answer:''},{test:void 0,answer:''},{test:NaN,answer:'NaN'},{test:new String('\n\r\n\r'),answer:'%0D%0A%0D%0A%0D'},{test:0,answer:'0'},{test:new String('hello world'),answer:'hello+world'}],h=0;h<f.length;h++){g=f[h];var j=c._wwwFormUrlEncodePiece(g.test);expect(j).to.be.equal(g.answer)}})}),suite('errors',function(){test('treats status codes between 1 and 199 as errors',function(){c.send({url:'/responds_to_get_with_100'}),d.respond(),expect(c.succeeded).to.be.equal(!1)}),test('treats status codes between 300 and \u221E as errors',function(){c.send({url:'/responds_to_get_with_500'}),d.respond(),expect(c.succeeded).to.be.equal(!1)})}),suite('status codes',function(){test('status and statusText is set after a ambiguous request',function(){c.send({url:'/responds_to_get_with_0'}),d.respond(),expect(c.status).to.be.equal(0),expect(c.statusText).to.be.equal('')}),test('status and statusText is set after a request that succeeded',function(){c.send({url:'/responds_to_get_with_json'}),d.respond(),expect(c.status).to.be.equal(200),expect(c.statusText).to.be.equal('OK')}),test('status and statusText is set after a request that failed',function(){c.send({url:'/responds_to_get_with_500'}),d.respond(),expect(c.status).to.be.equal(500),expect(c.statusText).to.be.equal('Internal Server Error')})})});</script></body></html>