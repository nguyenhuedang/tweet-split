'use strict';import ApplyShim from'../src/apply-shim.js';import templateMap from'../src/template-map.js';import{getIsExtends,toCssText}from'../src/style-util.js';import*as ApplyShimUtils from'../src/apply-shim-utils.js';import documentWait from'../src/document-wait.js';import{getComputedStyleValue as _getComputedStyleValue,updateNativeProperties}from'../src/common-utils.js';import{CustomStyleInterfaceInterface}from'../src/custom-style-interface.js';import{nativeCssVariables,nativeShadow}from'../src/style-settings.js';var applyShim=new ApplyShim,ApplyShimInterface=function(){function a(){var b=this;babelHelpers.classCallCheck(this,a),this.customStyleInterface=null,documentWait(function(){b.ensure()}),applyShim.invalidCallback=ApplyShimUtils.invalidate}return babelHelpers.createClass(a,[{key:'ensure',value:function(){var c=this;this.customStyleInterface||(this.customStyleInterface=window.ShadyCSS.CustomStyleInterface,this.customStyleInterface&&(this.customStyleInterface.transformCallback=function(d){applyShim.transformCustomStyle(d)},this.customStyleInterface.validateCallback=function(){requestAnimationFrame(function(){c.customStyleInterface.enqueued&&c.flushCustomStyles()})}))}},{key:'prepareTemplate',value:function(c,d){this.ensure(),templateMap[d]=c;var e=applyShim.transformTemplate(c,d);c._styleAst=e}},{key:'flushCustomStyles',value:function(){if(this.ensure(),!!this.customStyleInterface){var c=this.customStyleInterface.processStyles();if(this.customStyleInterface.enqueued){for(var d=0;d<c.length;d++){var e=c[d],f=this.customStyleInterface.getStyleForCustomStyle(e);f&&applyShim.transformCustomStyle(f)}this.customStyleInterface.enqueued=!1}}}},{key:'styleSubtree',value:function(c,d){if(this.ensure(),d&&updateNativeProperties(c,d),c.shadowRoot){this.styleElement(c);for(var e=c.shadowRoot.children||c.shadowRoot.childNodes,f=0;f<e.length;f++)this.styleSubtree(e[f])}else for(var g=c.children||c.childNodes,h=0;h<g.length;h++)this.styleSubtree(g[h])}},{key:'styleElement',value:function(c){this.ensure();var d=getIsExtends(c),e=d.is,f=templateMap[e];if(f&&!ApplyShimUtils.templateIsValid(f)){ApplyShimUtils.templateIsValidating(f)||(this.prepareTemplate(f,e),ApplyShimUtils.startValidatingTemplate(f));var g=c.shadowRoot;if(g){var h=g.querySelector('style');h&&(h.__cssRules=f._styleAst,h.textContent=toCssText(f._styleAst))}}}},{key:'styleDocument',value:function(c){this.ensure(),this.styleSubtree(document.body,c)}}]),a}();if(!window.ShadyCSS||!window.ShadyCSS.ScopingShim){var applyShimInterface=new ApplyShimInterface,CustomStyleInterface=window.ShadyCSS&&window.ShadyCSS.CustomStyleInterface;window.ShadyCSS={prepareTemplate:function(b,c){applyShimInterface.flushCustomStyles(),applyShimInterface.prepareTemplate(b,c)},styleSubtree:function(b,c){applyShimInterface.flushCustomStyles(),applyShimInterface.styleSubtree(b,c)},styleElement:function(b){applyShimInterface.flushCustomStyles(),applyShimInterface.styleElement(b)},styleDocument:function(b){applyShimInterface.flushCustomStyles(),applyShimInterface.styleDocument(b)},getComputedStyleValue:function(b,c){return _getComputedStyleValue(b,c)},nativeCss:nativeCssVariables,nativeShadow:nativeShadow},CustomStyleInterface&&(window.ShadyCSS.CustomStyleInterface=CustomStyleInterface)}window.ShadyCSS.ApplyShim=applyShim;