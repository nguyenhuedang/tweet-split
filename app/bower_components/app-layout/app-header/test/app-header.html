<!DOCTYPE html><html><head><meta charset="UTF-8"><title>test for app-header</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <script>if (!window.customElements) { document.write('<!--'); }</script>
    <script type="text/javascript" src="../../../webcomponentsjs/custom-elements-es5-adapter.js"></script>
    <!--! do not remove -->
<script src="../../../webcomponentsjs/webcomponents-lite.js"></script><script src="../../../web-component-tester/browser.js"></script><script src="../../../test-fixture/test-fixture-mocha.js"></script><link rel="import" href="../../../test-fixture/test-fixture.html"><link rel="import" href="../../app-toolbar/app-toolbar.html"><link rel="import" href="../app-header.html"><style>body{margin:0;padding:0;}.header{position:fixed;top:0;left:0;width:100%;background:green;transition:none !important;}.content{width:1px;height:3000px;background-color:red;}</style></head><body><test-fixture id="testHeader"><template><div><app-header class="header"><app-toolbar><div condensed-title="">Title</div></app-toolbar><app-toolbar><div main-title="" spacer="">Title</div></app-toolbar></app-header><div class="content"></div></div></template></test-fixture><test-fixture id="testStickyElement"><template><div><app-header fixed="" condenses="" reveals="" class="header"><app-toolbar></app-toolbar><app-toolbar sticky=""></app-toolbar></app-header><div class="content"></div></div></template></test-fixture><script>function scrollTestHelper(a,b){function c(){var f=b.shift();f&&requestAnimationFrame(function(){Polymer.dom.flush(),f.callback(),0<b.length&&d()})}function d(){var f=a===document.documentElement?window.pageYOffset:a.scrollTop;b[0].y===f?c():a===document.documentElement?window.scrollTo(0,b[0].y):a.scrollTop=b[0].y}if(0<b.length){var e=a===document.documentElement?window:a;e.addEventListener('scroll',c),d()}}function assertHeaderIsFullSized(a){var b=a.getBoundingClientRect();assert.equal(b.top,0,'full sized at '+a._scrollTop),assert.equal(b.bottom,b.height,'full sized '+a._scrollTop)}function assertHeaderIsCondensed(a){var b=a.getBoundingClientRect();assert.equal(b.top+b.height,a._stickyEl.offsetHeight,'condensed at '+a._scrollTop)}function assertHeaderIsHidden(a){var b=a.getBoundingClientRect();assert.isBelow(b.bottom,0,'hidden at '+a._scrollTop)}suite('basic features',function(){var a,b,c,d;suiteSetup(function(){d={setUp:sinon.spy(),tearDown:sinon.spy(),run:sinon.spy()},Polymer.AppLayout.registerEffect('test-effect',d)}),setup(function(){a=fixture('testHeader'),b=a.querySelector('app-header'),c=a.querySelector('app-toolbar'),d.setUp.reset(),d.tearDown.reset(),d.run.reset()}),test('default values',function(){assert.isFalse(b.condenses),assert.isFalse(b.fixed),assert.isFalse(b.reveals),assert.isFalse(b.shadow)}),test('condenses',function(e){b.condenses=!0,flush(function(){scrollTestHelper(b.scrollTarget,[{y:0,callback:function(){assertHeaderIsFullSized(b)}},{y:c.offsetHeight,callback:function(){assertHeaderIsCondensed(b)}},{y:10*c.offsetHeight,callback:function(){assertHeaderIsHidden(b)}},{y:5*c.offsetHeight,callback:function(){assertHeaderIsHidden(b)}},{y:0,callback:function(){assertHeaderIsFullSized(b),e()}}])})}),test('fixed',function(e){b.fixed=!0,flush(function(){scrollTestHelper(b.scrollTarget,[{y:0,callback:function(){assertHeaderIsFullSized(b)}},{y:10*c.offsetHeight,callback:function(){assertHeaderIsFullSized(b),e()}}])})}),test('reveals',function(e){b.reveals=!0,flush(function(){scrollTestHelper(b.scrollTarget,[{y:0,callback:function(){assertHeaderIsFullSized(b)}},{y:10*c.offsetHeight,callback:function(){assertHeaderIsHidden(b)}},{y:5*c.offsetHeight,callback:function(){assertHeaderIsFullSized(b),e()}}])})}),test('condenses and reveals',function(e){b.condenses=!0,b.reveals=!0,flush(function(){scrollTestHelper(b.scrollTarget,[{y:0,callback:function(){assertHeaderIsFullSized(b)}},{y:c.offsetHeight,callback:function(){assertHeaderIsCondensed(b)}},{y:10*c.offsetHeight,callback:function(){assertHeaderIsHidden(b)}},{y:5*c.offsetHeight,callback:function(){assertHeaderIsCondensed(b)}},{y:0,callback:function(){assertHeaderIsFullSized(b),e()}}])})}),test('condenses and fixed',function(e){b.condenses=!0,b.fixed=!0,flush(function(){scrollTestHelper(b.scrollTarget,[{y:0,callback:function(){assertHeaderIsFullSized(b)}},{y:c.offsetHeight,callback:function(){assertHeaderIsCondensed(b)}},{y:10*c.offsetHeight,callback:function(){assertHeaderIsCondensed(b),e()}}])})}),test('simple effect',function(e){b.effects='test-effect',flush(function(){scrollTestHelper(b.scrollTarget,[{y:0,callback:function(){assert.isTrue(d.setUp.called),assert.deepEqual(d.run.lastCall.args,[0,0])}},{y:c.offsetHeight,callback:function(){assert.deepEqual(d.run.lastCall.args,[1,64])}},{y:2*c.offsetHeight,callback:function(){assert.deepEqual(d.run.lastCall.args,[2,128])}},{y:3*c.offsetHeight,callback:function(){assert.deepEqual(d.run.lastCall.args,[2.078125,133])}},{y:4*c.offsetHeight,callback:function(){assert.deepEqual(d.run.lastCall.args,[2.078125,133]),b.effects='',assert.isTrue(d.tearDown.called),e()}}])})}),test('effect with config',function(e){var f={startsAt:0.5,endsAt:0.75};b.effects='test-effect',b.effectsConfig={"test-effect":f},flush(function(){scrollTestHelper(b.scrollTarget,[{y:0,callback:function(){assert.isTrue(d.setUp.called),assert.deepEqual(d.setUp.lastCall.args,[f]),assert.deepEqual(d.run.lastCall.args,[0,0])}},{y:32,callback:function(){assert.deepEqual(d.run.lastCall.args,[0,32])}},{y:40,callback:function(){assert.deepEqual(d.run.lastCall.args,[0.5,40])}},{y:48,callback:function(){assert.deepEqual(d.run.lastCall.args,[1,48])}},{y:c.offsetHeight,callback:function(){assert.deepEqual(d.run.lastCall.args,[2,64]),b.effects='',assert.isTrue(d.tearDown.called),e()}}])})}),test('disabled state',function(e){b.effects='test-effect',flush(function(){scrollTestHelper(b.scrollTarget,[{y:0,callback:function(){assert.isTrue(d.setUp.called),assert.deepEqual(d.run.lastCall.args,[0,0]),b.disabled=!0}},{y:c.offsetHeight,callback:function(){assert.deepEqual(d.run.lastCall.args,[0,0]),b.disabled=!1}},{y:2*c.offsetHeight,callback:function(){assert.deepEqual(d.run.lastCall.args,[2,128]),e()}}])})}),test('isOnScreen',function(e){flush(function(){scrollTestHelper(b.scrollTarget,[{y:0,callback:function(){assert.isTrue(b.isOnScreen())}},{y:c.offsetHeight,callback:function(){assert.isTrue(b.isOnScreen())}},{y:2*c.offsetHeight,callback:function(){assert.isFalse(b.isOnScreen()),b.fixed=!0}},{y:3*c.offsetHeight,callback:function(){assert.isTrue(b.isOnScreen()),e()}}])})}),test('DOM references',function(e){flush(function(){assert.isNotNull(b._getDOMRef('backgroundFrontLayer')),assert.isNotNull(b._getDOMRef('backgroundRearLayer')),assert.isNotNull(b._getDOMRef('mainTitle')),assert.isNotNull(b._getDOMRef('condensedTitle')),e()})})}),suite('Sticky element',function(){var a,b;setup(function(){a=fixture('testStickyElement'),b=a.querySelector('app-header')}),test('sticky element reference',function(){Polymer.dom.flush(),assert.equal(b._stickyEl,b.querySelector('[sticky]'))}),test('should reveal the entire header',function(c){flush(function(){scrollTestHelper(b.scrollTarget,[{y:0,callback:function(){assertHeaderIsFullSized(b)}},{y:1e3,callback:function(){assertHeaderIsCondensed(b)}},{y:980,callback:function(){setTimeout(function(){assertHeaderIsFullSized(b),c()},100)}}])})})});</script></body></html>