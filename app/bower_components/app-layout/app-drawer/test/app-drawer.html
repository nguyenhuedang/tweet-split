<!DOCTYPE html><html><head><meta charset="UTF-8"><title>test for app-drawer</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <script>if (!window.customElements) { document.write('<!--'); }</script>
    <script type="text/javascript" src="../../../webcomponentsjs/custom-elements-es5-adapter.js"></script>
    <!--! do not remove -->
<script src="../../../webcomponentsjs/webcomponents-lite.js"></script><script src="../../../web-component-tester/browser.js"></script><script src="../../../test-fixture/test-fixture-mocha.js"></script><link rel="import" href="../../../polymer/polymer.html"><link rel="import" href="../../../test-fixture/test-fixture.html"><link rel="import" href="../app-drawer.html"><style is="custom-style">body{margin:0;}</style></head><body><test-fixture id="testDrawer"><template><app-drawer><input type="text"><div tabindex="0">Div</div><span>Not focusable</span></app-drawer></template></test-fixture><test-fixture id="rtlDrawer"><template><app-drawer dir="rtl"></app-drawer></template></test-fixture><script>suite('basic features',function(){function a(m,n,o){var p=new CustomEvent('keydown',{bubbles:!0,cancelable:!0});return p.keyCode=n,p.shiftKey=!!o,m.dispatchEvent(p),p}function b(m,n,o){assert.equal(l.lastCall.args[0],'translate3d('+m+'px,0,0)',o),assert.equal(parseFloat(j.style.opacity).toFixed(4),n.toFixed(4),o)}function c(){assert.equal(j.style.opacity,''),assert.equal(l.lastCall.args[0],'')}function f(m){assert.equal(k.style.transitionDuration,m),assert.equal(j.style.transitionDuration,m)}function g(m){assert.isBelow(parseFloat(k.style.transitionDuration),m),assert.isBelow(parseFloat(j.style.transitionDuration),m)}function h(m){assert.equal(k.style.transitionTimingFunction,m),assert.equal(j.style.transitionTimingFunction,m)}var i,j,k,l;setup(function(){i=fixture('testDrawer'),j=i.$.scrim,k=i.$.contentContainer,l=sinon.spy(i,'transform')}),test('default values',function(){assert.isFalse(i.opened),assert.isFalse(i.persistent),assert.equal(i.transitionDuration,200),assert.equal(i.align,'left'),assert.isFalse(i.swipeOpen),assert.isFalse(i.noFocusTrap)}),test('set scroll direction',function(m){Polymer.RenderStatus.afterNextRender(i,function(){assert.oneOf(i.__polymerGesturesTouchAction,['y','pan-y']),m()})}),test('transitionDuration property',function(m){Polymer.RenderStatus.afterNextRender(i,function(){f('200ms'),i.transitionDuration=10,f('10ms'),m()})}),test('computed position',function(){rtlDrawer.align='start',assert.equal(i.position,'left'),i.align='end',assert.equal(i.position,'right'),i.align='left',assert.equal(i.position,'left'),i.align='right',assert.equal(i.position,'right')}),test('computed position for RTL',function(){var m=fixture('rtlDrawer');m.align='start',assert.equal(m.position,'right'),m.align='end',assert.equal(m.position,'left'),m.align='right',assert.equal(m.position,'right'),m.align='left',assert.equal(m.position,'left')}),test('left drawer opens and closes',function(){i.align='left',i.transitionDuration=0;var m=k.getBoundingClientRect();assert.isTrue(0>=m.right),i.opened=!0,m=k.getBoundingClientRect(),assert.equal(m.left,0),i.opened=!1,m=k.getBoundingClientRect(),assert.isTrue(0>=m.right)}),test('right drawer opens and closes',function(){i.align='right',i.transitionDuration=0;var m=k.getBoundingClientRect();assert.isTrue(m.left>=window.innerWidth),i.opened=!0,m=k.getBoundingClientRect(),assert.equal(m.right,window.innerWidth),i.opened=!1,m=k.getBoundingClientRect(),assert.isTrue(m.left>=window.innerWidth)}),test('open(), close(), and toggle()',function(){assert.isFalse(i.opened),i.open(),assert.isTrue(i.opened),i.close(),assert.isFalse(i.opened),i.toggle(),assert.isTrue(i.opened),i.toggle(),assert.isFalse(i.opened)}),test('getWidth()',function(){assert.equal(i.getWidth(),k.offsetWidth)}),test('app-reset-layout',function(){var m=sinon.spy();i.addEventListener('app-reset-layout',m),i.align='right',assert.isTrue(m.called)}),test('app-drawer-transitioned',function(m){window.setTimeout(function(){var n=sinon.spy();i.transitionDuration=1,i.addEventListener('app-drawer-transitioned',n),i.persistent=!0,assert.isFalse(n.called,'should not fire after toggling persistent when closed'),i.opened=!0,window.setTimeout(function(){assert.equal(n.callCount,1,'should fire after toggling opened state'),i.persistent=!1,window.setTimeout(function(){assert.equal(n.callCount,2,'should fire after toggling persistent when opened'),i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:0,ddx:0}),i.fire('track',{state:'end',dx:-200,ddx:-200}),window.setTimeout(function(){assert.isFalse(i.opened),assert.equal(n.callCount,3,'should fire after flinging'),i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:10,ddx:10}),i.fire('track',{state:'end',dx:10,ddx:0}),window.setTimeout(function(){assert.isFalse(i.opened),assert.equal(n.callCount,4,'should fire after swiping even if opened state unchanged'),i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:200,ddx:200}),i.fire('track',{state:'end',dx:200,ddx:0}),window.setTimeout(function(){assert.isTrue(i.opened),assert.equal(n.callCount,5,'should fire after swiping'),i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:-1e3,ddx:-1e3}),i.fire('track',{state:'end',dx:-1e3,ddx:0}),window.setTimeout(function(){assert.isFalse(i.opened),assert.equal(n.callCount,6,'should fire after swiping beyond end state'),m()},50)},50)},50)},50)},50)},50)},300)}),test('app-drawer-transitioned when transitionDuration is 0',function(m){window.setTimeout(function(){var n=sinon.spy();i.transitionDuration=0,i.addEventListener('app-drawer-transitioned',n),i.persistent=!0,assert.isFalse(n.called,'should not fire after toggling persistent when closed'),i.opened=!0,window.setTimeout(function(){assert.equal(n.callCount,1,'should fire after toggling opened state'),i.persistent=!1,window.setTimeout(function(){assert.equal(n.callCount,2,'should fire after toggling persistent when opened'),i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:0,ddx:0}),i.fire('track',{state:'end',dx:-200,ddx:-200}),window.setTimeout(function(){assert.isFalse(i.opened),assert.equal(n.callCount,3,'should fire after flinging'),i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:200,ddx:200}),i.fire('track',{state:'end',dx:200,ddx:0}),window.setTimeout(function(){assert.isTrue(i.opened),assert.equal(n.callCount,4,'should fire after swiping'),i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:-1e3,ddx:-1e3}),i.fire('track',{state:'end',dx:-1e3,ddx:0}),window.setTimeout(function(){assert.isFalse(i.opened),assert.equal(n.callCount,5,'should fire after swiping beyond end state'),m()},50)},50)},50)},50)},50)},300)}),test('disable swipe',function(m){Polymer.RenderStatus.afterNextRender(i,function(){var n=i.getWidth();i.disableSwipe=!0,i.fire('track',{state:'start'});var p=i.fire('track',{state:'track',dx:n/2,ddx:n},{cancelable:!0});assert.isFalse(p.defaultPrevented),assert.isFalse(l.called),m()})}),test('track events block user selection',function(m){Polymer.RenderStatus.afterNextRender(i,function(){var n=i.fire('track',null,{cancelable:!0});assert.isTrue(n.defaultPrevented),m()})}),test('styles reset after swiping',function(m){Polymer.RenderStatus.afterNextRender(i,function(){i.fire('track',{state:'start'}),assert.equal(i.style.visibility,'visible'),f('0ms'),i.fire('track',{state:'track',dx:200,ddx:200}),i.fire('track',{state:'end',dx:200,ddx:0}),assert.equal(i.style.visibility,''),f('200ms'),c(),m()})}),test('styles reset after swiping beyond the end state',function(m){Polymer.RenderStatus.afterNextRender(i,function(){i.fire('track',{state:'start'}),assert.equal(i.style.visibility,'visible'),f('0ms'),i.fire('track',{state:'track',dx:1e3,ddx:1e3}),i.fire('track',{state:'end',dx:1e3,ddx:0}),assert.equal(i.style.visibility,''),f('200ms'),c(),m()})}),test('left drawer swiping',function(m){i.transitionDuration=10,i.align='left',Polymer.RenderStatus.afterNextRender(i,function(){var n=i.getWidth(),o=n/2;i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:-o,ddx:-o}),b(-n,0,'styles are lower bounded'),i.fire('track',{state:'track',dx:o,ddx:n}),b(-o,0.5,'style by track distance'),i.fire('track',{state:'track',dx:o+n,ddx:n}),b(0,1,'styles are upper bounded'),i._trackDetails=[],i.fire('track',{state:'end',dx:o,ddx:-n}),assert.isFalse(i.opened,'drawer stays closed when track distance is small'),i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:o+1,ddx:o+1}),i.fire('track',{state:'end',dx:o+1,ddx:0}),assert.isTrue(i.opened,'drawer opens when track distance is large'),i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:-o,ddx:-o}),i.fire('track',{state:'end',dx:-o,ddx:0}),assert.isTrue(i.opened,'drawer stays opened when track distance is small'),i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:-o-1,ddx:-o-1}),i.fire('track',{state:'end',dx:-o-1,ddx:0}),assert.isFalse(i.opened,'drawer closes when track distance is large'),m()})}),test('right drawer swiping',function(m){i.transitionDuration=10,i.align='right',window.setTimeout(function(){Polymer.RenderStatus.afterNextRender(i,function(){var n=i.getWidth(),o=n/2;i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:o,ddx:o}),b(n,0,'styles are lower bounded'),i.fire('track',{state:'track',dx:-o,ddx:-n}),b(o,0.5,'style by track distance'),i.fire('track',{state:'track',dx:-o-n,ddx:-n}),b(0,1,'styles are upper bounded'),i._trackDetails=[],i.fire('track',{state:'end',dx:-o,ddx:n}),assert.isFalse(i.opened,'drawer stays closed when track distance is small'),i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:-o-1,ddx:-o-1}),i.fire('track',{state:'end',dx:-o-1,ddx:0}),assert.isTrue(i.opened,'drawer opens when track distance is large'),i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:o,ddx:o}),i.fire('track',{state:'end',dx:o,ddx:0}),assert.isTrue(i.opened,'drawer stays opened when track distance is small'),i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:o+1,ddx:o+1}),i.fire('track',{state:'end',dx:o+1,ddx:0}),assert.isFalse(i.opened,'drawer closes when track distance is large'),m()})},100)}),test('styles reset after flinging',function(m){Polymer.RenderStatus.afterNextRender(i,function(){i.fire('track',{state:'start'}),assert.equal(i.style.visibility,'visible'),f('0ms'),i.fire('track',{state:'track',dx:0,ddx:0}),i.fire('track',{state:'end',dx:200,ddx:200}),window.setTimeout(function(){assert.equal(i.style.visibility,''),f('200ms'),h(''),c(),m()},100)})}),test('styles reset after flinging beyond the end state',function(m){Polymer.RenderStatus.afterNextRender(i,function(){i.fire('track',{state:'start'}),assert.equal(i.style.visibility,'visible'),f('0ms'),i.fire('track',{state:'track',dx:0,ddx:0}),i.fire('track',{state:'end',dx:1e3,ddx:1e3}),assert.equal(i.style.visibility,''),f('200ms'),h(''),c(),m()})}),test('left drawer flinging open',function(m){i.transitionDuration=10,i.align='left',Polymer.RenderStatus.afterNextRender(i,function(){i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:0,ddx:0}),i.fire('track',{state:'end',dx:0.1,ddx:0.1}),assert.isFalse(i.opened,'drawer stays closed when velocity is small'),f('10ms'),h(''),c(),i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:0,ddx:0}),i.fire('track',{state:'end',dx:50,ddx:50}),assert.isTrue(i.opened,'drawer opens when velocity is large'),g(150),h(i._FLING_TIMING_FUNCTION),c(),window.setTimeout(function(){f('10ms'),h(''),m()},100)})}),test('left drawer flinging close',function(m){i.transitionDuration=10,i.align='left',i.opened=!0,Polymer.RenderStatus.afterNextRender(i,function(){i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:0,ddx:0}),i.fire('track',{state:'end',dx:-0.1,ddx:-0.1}),assert.isTrue(i.opened,'drawer stays opened when velocity is small'),f('10ms'),h(''),c(),i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:0,ddx:0}),i.fire('track',{state:'end',dx:-50,ddx:-50}),assert.isFalse(i.opened,'drawer closes when velocity is large'),g(150),h(i._FLING_TIMING_FUNCTION),c(),window.setTimeout(function(){f('10ms'),h(''),m()},100)})}),test('right drawer flinging open',function(m){i.transitionDuration=10,i.align='right',window.setTimeout(function(){Polymer.RenderStatus.afterNextRender(i,function(){i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:0,ddx:0}),i.fire('track',{state:'end',dx:-0.1,ddx:-0.1}),assert.isFalse(i.opened,'drawer stays closed when velocity is small'),f('10ms'),h(''),c(),i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:0,ddx:0}),i.fire('track',{state:'end',dx:-50,ddx:-50}),assert.isTrue(i.opened,'drawer opens when velocity is large'),g(150),h(i._FLING_TIMING_FUNCTION),c(),window.setTimeout(function(){f('10ms'),h(''),m()},100)})},100)}),test('right drawer flinging close',function(m){i.transitionDuration=10,i.align='right',i.opened=!0,window.setTimeout(function(){Polymer.RenderStatus.afterNextRender(i,function(){i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:0,ddx:0}),i.fire('track',{state:'end',dx:0.1,ddx:0.1}),assert.isTrue(i.opened,'drawer stays opened when velocity is small'),f('10ms'),h(''),c(),i.fire('track',{state:'start'}),i.fire('track',{state:'track',dx:0,ddx:0}),i.fire('track',{state:'end',dx:50,ddx:50}),assert.isFalse(i.opened,'drawer closes when velocity is large'),g(150),h(i._FLING_TIMING_FUNCTION),c(),window.setTimeout(function(){f('10ms'),h(''),m()},100)})},100)}),test('doc scroll',function(m){i.transitionDuration=0,i.opened=!0,window.setTimeout(function(){assert.equal(document.body.style.overflow,'hidden','should block scrolling when opened'),i.persistent=!0,window.setTimeout(function(){assert.equal(document.body.style.overflow,'','should not block scrolling when persistent'),i.persistent=!1,window.setTimeout(function(){assert.equal(document.body.style.overflow,'hidden','should block scrolling when not persistent'),i.opened=!1,window.setTimeout(function(){assert.equal(document.body.style.overflow,'','should not block scrolling when closed'),m()},50)},50)},50)},50)}),test('focus trap',function(m){var n=Polymer.dom(i).querySelector('input'),o=Polymer.dom(i).querySelector('div[tabindex]'),p=sinon.spy(n,'focus'),q=sinon.spy(o,'focus');Polymer.RenderStatus.afterNextRender(i,function(){i.transitionDuration=0,i.opened=!0,window.setTimeout(function(){assert.isTrue(p.called);var r=a(n,9);assert.isFalse(r.defaultPrevented,'should not prevent default'),n.focus(),p.reset(),r=a(n,9,!0),assert.isTrue(q.called),assert.isTrue(r.defaultPrevented,'should prevent default'),r=a(o,9,!0),assert.isFalse(r.defaultPrevented,'should not prevent default'),o.focus(),r=a(o,9),assert.isTrue(p.called),assert.isTrue(r.defaultPrevented,'should prevent default'),m()},50)})}),test('focus trap with app-drawer tabindex set',function(m){var n=Polymer.dom(i).querySelector('input'),o=sinon.spy(i,'focus'),p=sinon.spy(n,'focus');Polymer.RenderStatus.afterNextRender(i,function(){i.transitionDuration=0,i.tabIndex=0,i.opened=!0,window.setTimeout(function(){assert.isTrue(o.called),assert.isFalse(p.called),m()},50)})}),test('no focus trap',function(m){var n=Polymer.dom(i).querySelector('input'),o=sinon.spy(n,'focus');Polymer.RenderStatus.afterNextRender(i,function(){i.transitionDuration=0,i.noFocusTrap=!0,i.opened=!0,assert.isFalse(o.called),m()})}),test('esc key handler',function(m){Polymer.RenderStatus.afterNextRender(i,function(){i.transitionDuration=0,i.opened=!0,window.setTimeout(function(){var n=a(document,27);assert.isFalse(i.opened,'should close drawer on esc'),assert.isTrue(n.defaultPrevented,'should prevent default'),m()},50)})}),test('scrim',function(){i.transitionDuration=0,assert.equal(window.getComputedStyle(j).opacity,0),i.opened=!0,assert.equal(window.getComputedStyle(j).opacity,1),i.persistent=!0,assert.equal(window.getComputedStyle(j).opacity,0)}),test('click on scrim closes drawer',function(){i.opened=!0,i.fire('click',null,{node:j}),assert.isFalse(i.opened)}),test('persistent drawer should not cover content',function(){i.opened=!0,i.persistent=!0,assert.notEqual(document.elementFromPoint(400,10).tagName,'APP-DRAWER')}),test('right persistent drawer should be in the correct position',function(){i.align='right',i.opened=!0,i.persistent=!0,assert.equal(i.getBoundingClientRect().right,window.innerWidth)})});</script></body></html>