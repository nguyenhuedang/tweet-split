<!DOCTYPE html><html><head><title>iron-location</title>
    <script>if (!window.customElements) { document.write('<!--'); }</script>
    <script type="text/javascript" src="../../webcomponentsjs/custom-elements-es5-adapter.js"></script>
    <!--! do not remove -->
<script src="../../webcomponentsjs/webcomponents-lite.js"></script><script src="../../web-component-tester/browser.js"></script><link rel="import" href="../../polymer/polymer.html"><link rel="import" href="../../promise-polyfill/promise-polyfill.html"><link rel="import" href="../iron-location.html"><link rel="import" href="./redirection.html"><style>#safari-cooldown{font-size:18px;max-width:300px;}#safari-cooldown div{margin-bottom:20px;}</style></head><body><div id="safari-cooldown" hidden=""><div>Danger: URL overheating.</div><div>Safari requires a cooldown period before we call pushState/replaceState any more.</div><div>Testing will resume after 30 seconds.</div><div><a href="https://forums.developer.apple.com/thread/36650">More info</a></div></div><test-fixture id="Solo"><template><iron-location></iron-location></template></test-fixture><test-fixture id="Together"><template><div><iron-location id="one"></iron-location><iron-location id="two"></iron-location></div></template></test-fixture><test-fixture id="RedirectHash"><template><redirect-hash></redirect-hash></template></test-fixture><test-fixture id="RedirectPath"><template><redirect-path></redirect-path></template></test-fixture><test-fixture id="RedirectQuery"><template><redirect-query></redirect-query></template></test-fixture><script>'use strict';function timePasses(a){return new Promise(function(b){window.setTimeout(function(){b()},a)})}function makeAbsoluteUrl(a){return window.location.protocol+'//'+window.location.host+a}function replaceState(a){window.history.replaceState({},'',makeAbsoluteUrl(a))}function ironLocationTests(){suite('when used solo',function(){function a(){var d=document.createElement('iron-location');return document.body.appendChild(d),c.push(d),d}var b,c;setup(function(){replaceState('/'),b=fixture('Solo'),c=[]}),teardown(function(){for(var d=0;d<c.length;d++)document.body.removeChild(c[d])}),test('basic functionality with #hash urls',function(){expect(window.location.hash).to.be.equal(b.hash),b.hash='/lol/ok',expect(window.location.hash).to.be.equal('#/lol/ok');var d=document.createElement('a'),e=window.location.protocol+'//'+window.location.host+window.location.pathname;return d.href=e+'#/wat',document.body.appendChild(d),d.click(),timePasses(10).then(function(){expect(b.hash).to.be.equal('/wat')})}),test('basic functionality with paths',function(){expect(window.location.pathname).to.be.equal(b.path),b.path='/foo/bar',expect(window.location.pathname).to.be.equal('/foo/bar'),replaceState('/baz'),window.dispatchEvent(new CustomEvent('location-changed')),expect(b.path).to.be.equal('/baz')}),test('dealing with paths with unusual characters',function(){var d={"/foo":'/foo',"/":'/',"/foo bar":'/foo%20bar',"/foo#bar":'/foo%23bar',"/foo?xyz":'/foo%3Fxyz',"/foo'bar'baz":'/foo\'bar\'baz'};for(var e in d){var f=d[e];b.path=e,expect(window.location.pathname).to.be.equal(f),expect(b.path).to.be.equal(e);var g=a();expect(g.path).to.be.equal(e)}}),test('dealing with hashes with unusual characters',function(){var d={foo:'#foo',"":'',"foo bar":['#foo%20bar','#foo bar'],"foo#bar":'#foo#bar',"foo?bar":'#foo?bar',"/foo'bar'baz":['#/foo%27bar%27baz','#/foo\'bar\'baz']};for(var e in d){var f=d[e];'string'===typeof f&&(f=[f]),b.hash=e,expect(f).to.contain(window.location.hash),expect(b.hash).to.be.equal(e),expect(a().hash).to.be.equal(e)}}),test('dealing with queries with unusual characters',function(){var d={foo:'?foo',"":'',"foo bar":'?foo%20bar',"foo#bar":'?foo%23bar',"foo?bar":'?foo?bar',"/foo'bar'baz":['?/foo%27bar%27baz','?/foo\'bar\'baz'],"foo/bar/baz":'?foo/bar/baz'};for(var e in d){var f=d[e];'string'===typeof f&&(f=[f]);var g=f.map(function(h){return h.substring(1)});expect(b._initialized).to.be.eq(!0),b.query=e,expect(f).to.contain(window.location.search),expect(g).to.contain(b.query),expect(g).to.contain(a().query),b.query='dummyValue',b.query=g[0],expect(f).to.contain(window.location.search),expect(g).to.contain(b.query),expect(g).to.contain(a().query)}}),test('assigning to a relative path URL',function(){b.path='/foo/bar',expect(window.location.pathname).to.be.equal('/foo/bar'),b.path='baz',expect(window.location.pathname).to.be.equal('/baz')}),test('basic functionality with ?key=value params',function(){expect(b.query).to.be.eq(''),replaceState('/?greeting=hello&target=world'),window.dispatchEvent(new CustomEvent('location-changed')),expect(b.query).to.be.equal('greeting=hello&target=world'),b.query='greeting=hello&target=world&another=key',expect(window.location.search).to.be.equal('?greeting=hello&target=world&another=key')})}),suite('does not spam the user\'s history',function(){var a,b,c,d;setup(function(){a=b=0,c=window.history.replaceState,d=window.history.pushState,window.history.replaceState=function(){a++},window.history.pushState=function(){b++}}),teardown(function(){window.history.replaceState=c,window.history.pushState=d}),test('when a change happens immediately after the iron-location is attached',function(){var e=fixture('Solo');expect(b).to.be.equal(0),expect(a).to.be.equal(0),e.path='/foo',expect(a).to.be.equal(1),expect(b).to.be.equal(0)}),suite('when intercepting links',function(){function e(f,g){function h(l){expect(l.target).to.be.eq(f),j=l.defaultPrevented,l.preventDefault(),expect(l.defaultPrevented).to.be.eq(!0)}var j;window.addEventListener('click',h);var k=fixture('Solo');return null!=g&&(k.urlSpaceRegex=g),document.body.appendChild(f),f.click(),document.body.removeChild(f),window.removeEventListener('click',h),j}test('simple link to / is intercepted',function(){var f=document.createElement('a');f.href=document.baseURI===window.location.href?'/':makeAbsoluteUrl('/'),expect(e(f)).to.be.eq(!0),expect(b).to.be.equal(1)}),test('link that matches url space is intercepted',function(){var f=document.createElement('a');f.href=makeAbsoluteUrl('/foo'),expect(e(f,'/fo+')).to.be.eq(!0),expect(b).to.be.equal(1)}),test('link that doesn\'t match url space isn\'t intercepted',function(){var f=document.createElement('a');f.href=makeAbsoluteUrl('/bar'),expect(e(f,'/fo+')).to.be.eq(!1),expect(b).to.be.equal(0)}),test('link to another domain isn\'t intercepted',function(){var f=document.createElement('a');f.href='http://example.com/',expect(e(f)).to.be.eq(!1),expect(b).to.be.equal(0)}),test('a link with target=_blank isn\'t intercepted',function(){var f=document.createElement('a');f.href=makeAbsoluteUrl('/'),f.target='_blank',expect(e(f)).to.be.eq(!1),expect(b).to.be.equal(0)}),test('a link with an href to the current page shouldn\'t add to history.',function(){var f=document.createElement('a');f.href=window.location.href,expect(e(f)).to.be.equal(!0),expect(b).to.be.equal(0)}),test('a click that has already been defaultPrevented shouldn\'t result in a navigation',function(){fixture('Solo');var f=document.createElement('a');f.href=makeAbsoluteUrl('/'),f.addEventListener('click',function(j){j.preventDefault()}),document.body.appendChild(f);var g=window.history.pushState,h=0;window.history.pushState=function(){h++},f.click(),window.history.pushState=g,expect(h).to.be.equal(0)})})}),suite('when used with other iron-location elements',function(){function a(d,e){expect(d.path).to.be.equal(e.path),expect(d.hash).to.be.equal(e.hash),expect(d.query).to.be.equal(e.query)}var b,c;setup(function(){var d=fixture('Together');c=d.querySelector('#one'),b=d.querySelector('#two')}),test('coordinate their changes (by firing events on window)',function(){a(c,b),c.path='/a/b/c',a(c,b),b.query='alsdkjflaksjfd=alksjfdlkajsdfl',a(c,b),c.hash='lkjljifosjkldfjlksjfldsjf',a(c,b)})}),suite('supports doing synchronous redirection',function(){test('of the hash portion of the URL',function(){expect(window.location.hash).to.be.equal('');var a=fixture('RedirectHash');expect(window.location.hash).to.be.equal('#redirectedTo'),expect(a.hash).to.be.equal('redirectedTo'),a.hash='newHash',expect(window.location.hash).to.be.equal('#redirectedTo'),expect(a.hash).to.be.equal('redirectedTo')}),test('of the path portion of the URL',function(){expect(window.location.pathname).to.not.be.equal('/redirectedTo');var a=fixture('RedirectPath');expect(window.location.pathname).to.be.equal('/redirectedTo'),expect(a.path).to.be.equal('/redirectedTo'),a.path='/newPath',expect(window.location.pathname).to.be.equal('/redirectedTo'),expect(a.path).to.be.equal('/redirectedTo')}),test('of the query portion of the URL',function(){expect(window.location.search).to.not.be.equal('?redirectedTo');var a=fixture('RedirectQuery');expect(window.location.search).to.be.equal('?redirectedTo'),expect(a.query).to.be.equal('redirectedTo'),a.query='newQuery',expect(window.location.search).to.be.equal('?redirectedTo'),expect(a.query).to.be.equal('redirectedTo')})})}suite('<iron-location>',function(){var a;setup(function(){a=window.location.href}),teardown(function(){window.history.replaceState({},'',a)});var b=function(){};/^Apple/.test(navigator.vendor)&&(b=function(d){var e=30000;this.timeout(e+5e3);var f=document.querySelector('#safari-cooldown');f.removeAttribute('hidden'),setTimeout(function(){d(),f.setAttribute('hidden','hidden')},e)}),suite('without a base URI',function(){ironLocationTests(),suiteTeardown(b)}),suite('with a base URI',function(){var c;setup(function(){expect(document.baseURI).to.be.equal(window.location.href),c=document.createElement('base');var d='https://example.com/i/dont/exist/obviously';c.href=d,document.head.appendChild(c),expect(document.baseURI).to.be.equal(d)}),teardown(function(){document.head.removeChild(c)}),suiteTeardown(b),ironLocationTests()})});</script></body></html>